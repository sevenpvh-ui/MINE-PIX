<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Mines Pix</title>
    <style>
        body { background-color: #0f1923; color: white; font-family: 'Segoe UI', sans-serif; padding: 0; margin: 0; display: flex; height: 100vh; overflow: hidden;}
        .sidebar { width: 250px; background: #1a242d; border-right: 1px solid #333; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .logo { font-size: 22px; font-weight: bold; color: white; margin-bottom: 30px; text-align: center; }
        .menu-item { padding: 12px; border-radius: 8px; cursor: pointer; color: #b1bad3; font-weight: 500; transition: 0.2s; }
        .menu-item:hover, .menu-item.active { background: #2f4553; color: white; }
        .content { flex: 1; padding: 30px; overflow-y: auto; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
        h1 { margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #1a242d; padding: 20px; border-radius: 10px; border: 1px solid #2f4553; }
        .card h3 { margin: 0 0 5px 0; font-size: 13px; color: #b1bad3; text-transform: uppercase; }
        .card p { margin: 0; font-size: 28px; font-weight: bold; }
        .green { color: #00e701; } .red { color: #ff4d4d; }
        table { width: 100%; border-collapse: collapse; background: #1a242d; border-radius: 8px; overflow: hidden; font-size: 14px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #2f4553; }
        th { background: #25303b; color: #b1bad3; }
        tr:hover { background: #25303b; }
        .btn { padding: 6px 12px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-approve { background: #00e701; color: black; }
        .btn-reject { background: #ff4d4d; color: white; margin-left: 5px; }
        .btn-edit { background: #00a8ff; color: white; }
        .search-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        input, select { background: #1a242d; border: 1px solid #2f4553; color: white; padding: 10px; border-radius: 5px; flex: 1; }
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#0f1923; display:flex; justify-content:center; align-items:center; z-index:100; }
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:50; display:none; justify-content:center; align-items:center; }
        .modal { background: #1a242d; padding: 20px; border-radius: 10px; width: 300px; border: 1px solid #2f4553; }
        .modal label { display: block; margin-top: 10px; font-size: 12px; color: #b1bad3; }
    </style>
</head>
<body>
    <div id="login-screen"><div style="text-align:center;width:300px"><h2>üõ°Ô∏è Admin Mines</h2><input type="password" id="admin-pass" placeholder="Senha" style="width:100%;margin-bottom:10px"><button class="btn btn-approve" style="width:100%;padding:12px" onclick="checkAdmin()">ACESSAR</button></div></div>
    <div class="sidebar">
        <div class="logo">üíé ADMIN</div>
        <div class="menu-item active" onclick="showTab('dashboard')">üìä Dashboard</div>
        <div class="menu-item" onclick="showTab('withdrawals')">üí∏ Saques</div>
        <div class="menu-item" onclick="showTab('users')">üë• Usu√°rios</div>
        <div class="menu-item" onclick="showTab('affiliates')">ü§ù Afiliados</div>
        <div class="menu-item" onclick="showTab('settings')">‚öôÔ∏è Configura√ß√µes</div>
    </div>
    <div class="content">
        <div id="dashboard" class="section active"><h1>Vis√£o Geral</h1><div class="stats-grid"><div class="card"><h3>Entrada</h3><p class="green" id="stat-deposited">R$ 0.00</p></div><div class="card"><h3>Sa√≠da</h3><p class="red" id="stat-withdrawn">R$ 0.00</p></div><div class="card"><h3>Lucro</h3><p id="stat-profit">R$ 0.00</p></div><div class="card"><h3>Saldo Jogadores</h3><p style="color:orange" id="stat-balance">R$ 0.00</p></div></div></div>
        <div id="withdrawals" class="section"><h1>Saques Pendentes</h1><table><thead><tr><th>CPF</th><th>Valor</th><th>Chave PIX</th><th>Data</th><th>A√ß√£o</th></tr></thead><tbody id="withdraw-list"></tbody></table></div>
        <div id="users" class="section"><h1>Usu√°rios</h1><div class="search-bar"><input type="text" id="search-input" placeholder="Buscar CPF"><button class="btn btn-edit" onclick="loadUsers()">BUSCAR</button></div><table><thead><tr><th>Nome</th><th>CPF</th><th>Saldo</th><th>Status</th><th>A√ß√£o</th></tr></thead><tbody id="users-list"></tbody></table></div>
        <div id="affiliates" class="section"><h1>Afiliados</h1><table><thead><tr><th>Nome</th><th>Convidados</th><th>Comiss√£o Paga</th></tr></thead><tbody id="affiliates-list"></tbody></table></div>
        
        <div id="settings" class="section">
            <h1>‚öôÔ∏è Configura√ß√µes</h1>
            <div class="card" style="max-width:400px">
                <label style="color:white">B√¥nus Di√°rio (R$)</label>
                <input type="number" id="setting-bonus" step="0.10">
                
                <label style="color:white; margin-top:20px;">Margem de Lucro da Casa</label>
                <select id="setting-edge" style="width:100%">
                    <option value="0.98">2% (Muito F√°cil - Atrair)</option>
                    <option value="0.95">5% (Padr√£o - Justo)</option>
                    <option value="0.90">10% (Lucrativo)</option>
                    <option value="0.80">20% (Dif√≠cil - Recuperar Caixa)</option>
                    <option value="0.60">40% (Imposs√≠vel - Modo Ceifador)</option>
                </select>
                
                <button class="btn btn-approve" style="margin-top:15px;width:100%;padding:10px" onclick="saveSettings()">SALVAR</button>
            </div>
        </div>
    </div>

    <div id="edit-modal" class="modal-overlay"><div class="modal"><h3>Editar Usu√°rio</h3><input type="hidden" id="edit-id"><label>Novo Saldo</label><input type="number" id="edit-balance"><label>Status</label><select id="edit-banned"><option value="false">Ativo</option><option value="true">Banido</option></select><div style="margin-top:15px;display:flex;gap:10px"><button class="btn btn-approve" style="flex:1" onclick="saveUser()">SALVAR</button><button class="btn btn-reject" style="flex:1" onclick="closeEdit()">CANCELAR</button></div></div></div>

    <script>
        let adminKey='';
        function checkAdmin(){const p=document.getElementById('admin-pass').value;if(p==='admin123'){adminKey=p;document.getElementById('login-screen').style.display='none';loadDashboard()}else{alert("Senha incorreta")}}
        function showTab(id){document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));document.getElementById(id).classList.add('active');event.target.classList.add('active');if(id==='settings')loadSettings();else loadDashboard()}
        
        async function loadDashboard(){
            const res=await fetch('/api/admin/dashboard',{headers:{'secret':adminKey}});const data=await res.json();
            document.getElementById('stat-deposited').innerText=`R$ ${data.financials.deposited.toFixed(2)}`;document.getElementById('stat-withdrawn').innerText=`R$ ${data.financials.withdrawn.toFixed(2)}`;document.getElementById('stat-profit').innerText=`R$ ${data.financials.profit.toFixed(2)}`;document.getElementById('stat-balance').innerText=`R$ ${data.totalBalance.toFixed(2)}`;
            const w=document.getElementById('withdraw-list');w.innerHTML='';data.pendingWithdrawals.forEach(x=>{w.innerHTML+=`<tr><td>${x.cpf}</td><td class="green">R$ ${x.amount.toFixed(2)}</td><td>${x.pixKey}</td><td>${new Date(x.date).toLocaleDateString()}</td><td><button class="btn btn-approve" onclick="act('${x.userId}','${x.transId}','approve')">V</button><button class="btn btn-reject" onclick="act('${x.userId}','${x.transId}','reject')">X</button></td></tr>`});
            const a=document.getElementById('affiliates-list');a.innerHTML='';data.topAffiliates.forEach(x=>{a.innerHTML+=`<tr><td>${x.name}</td><td>${x.count}</td><td class="green">R$ ${x.earnings.toFixed(2)}</td></tr>`});
        }
        async function loadUsers(){const s=document.getElementById('search-input').value;const res=await fetch('/api/admin/users',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({secret:adminKey,search:s})});const u=await res.json();const l=document.getElementById('users-list');l.innerHTML='';u.forEach(x=>{l.innerHTML+=`<tr><td>${x.name}</td><td>${x.cpf}</td><td>R$ ${x.balance.toFixed(2)}</td><td>${x.isBanned?'Banido':'Ativo'}</td><td><button class="btn btn-edit" onclick="openEdit('${x._id}','${x.balance}','${x.isBanned}')">Edit</button></td></tr>`})}
        async function loadSettings(){const res=await fetch('/api/admin/settings',{headers:{'secret':adminKey}});const d=await res.json();document.getElementById('setting-bonus').value=d.dailyBonus;document.getElementById('setting-edge').value=d.houseEdge;}
        async function saveSettings(){const b=document.getElementById('setting-bonus').value;const e=document.getElementById('setting-edge').value;await fetch('/api/admin/settings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({secret:adminKey,dailyBonus:b,houseEdge:e})});alert("Salvo!")}
        async function act(uid,tid,act){if(!confirm("Confirma?"))return;await fetch('/api/admin/action',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:uid,transId:tid,action:act,secret:adminKey})});loadDashboard()}
        function openEdit(id,bal,ban){document.getElementById('edit-id').value=id;document.getElementById('edit-balance').value=bal;document.getElementById('edit-banned').value=ban;document.getElementById('edit-modal').style.display='flex'}
        function closeEdit(){document.getElementById('edit-modal').style.display='none'}
        async function saveUser(){const id=document.getElementById('edit-id').value;const bal=document.getElementById('edit-balance').value;const ban=document.getElementById('edit-banned').value==='true';await fetch('/api/admin/user/update',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:id,newBalance:bal,isBanned:ban,secret:adminKey})});alert("Salvo!");closeEdit();loadUsers()}
    </script>
</body>
</html>
